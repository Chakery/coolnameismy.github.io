---
layout: post
title: iOS动画和特效（四）controller间的自定义过渡效果
category: 技术
tags:
description:
---
>   前面动画和特效系类文章中有一篇写了UIView的过渡效果，而这一篇主要说的是UIViewController的自定义过渡效果和过渡交互

本文demo的效果图

![]()


## 出场人物介绍
>   介绍下Controller过渡和交互用到的类

### presention and presented

A中模态显示B,那么A就是presention，b就是presented，后续内容会使用这种叫法称呼Modal下的2个controller

### UIViewControllerTransitioningDelegate

controller modal过渡的presented和dismiss的动画交互协议，你需要实现协议，它会询问你：

-   当PresentedController时，你要使用怎样的动画类（UIViewControllerAnimatedTransitioning）展示过渡效果？
-   当DismissedController时，你要使用怎样的动画类（UIViewControllerAnimatedTransitioning）展示过渡效果？
-   当PresentedController时，你要使用怎样的过渡交互类（UIViewControllerInteractiveTransitioning）处理过渡交互？
-   当DismissedController时，你要使用怎样的过渡交互类（UIViewControllerInteractiveTransitioning）处理过渡交互？
-   presentationControllerForPresentedViewController：这篇文章没有用到，应该是自定义modal状态呈现和被呈现的controller，类似于controller的PresentationStyle，想了解的可以参考下面两篇文章
[Present ViewController Modally ](http://www.cnblogs.com/smileEvday/archive/2012/05/29/presentModalViewController.html) 和
[iOS 8的PresentationController ](http://www.cocoachina.com/industry/20140707/9053.html)


### UIViewControllerAnimatedTransitioning

过渡动画效果的具体实现的接口，需要实现它的3个方法，即可完成一个controller过渡动画效果

-   ```` func animationEnded  ```` ：过渡动画完成后要执行的代码可以写到这个方法中
-   ```` func transitionDuration(transitionContext: UIViewControllerContextTransitioning?) -> NSTimeInterval```` ：给定一个过渡动画的执行时间
-   ```` func animateTransition(transitionContext: UIViewControllerContextTransitioning)```` ：具体过渡动画都在这个方法里面实现，在这个方法中可以通过transitionContext拿到一切你需要的对象，后面会有讲到


### UINavigationControllerDelegate

controller 非模态状态下的的过渡动画，就不能使用之前说的那个````UIViewControllerTransitioningDelegate````委托解决了，就需要用````UINavigationControllerDelegate````，接口方法比较类似，但也不完全一样

-   你要使用怎样的动画类（UIViewControllerAnimatedTransitioning）展示过渡效果？
-   你要使用怎样的过渡交互类（UIViewControllerInteractiveTransitioning）处理过渡交互？
-   willShowViewController，didShowViewController ： 生命周期事件
-   navigationControllerSupportedInterfaceOrientations: 屏幕支持的方向



### UIViewControllerContextTransitioning

UIViewControllerAnimatedTransitioning协议的关键方法```` animateTransition(transitionContext: UIViewControllerContextTransitioning) ````里面可以得到，使用transitionContext可以获取一些重要的上下文信息，比如前后的controller，转换时的容器等，示例如下


````swift
        //拿到前后的两个controller
        let fromVC = transitionContext.viewControllerForKey(UITransitionContextFromViewControllerKey)!
        let toVC = transitionContext.viewControllerForKey(UITransitionContextToViewControllerKey)!
        //拿到Presenting的最终Frame
        let finalFrameForVC = transitionContext.finalFrameForViewController(toVC)
        //拿到转换的容器view
        let containerView = transitionContext.containerView()
        //拿到过渡动画执行时间
        transitionDuration(transitionContext)
````



## controller modal过渡效果

我们先来实现一个简单的示例，点击一个按钮，出现一个modal controller，自定义从下往上弹出并且有些回弹效果的过渡动画。从这个例子中我们可以了解

-   如何实现UIViewControllerTransitioningDelegate
-   如何实现UIViewControllerAnimatedTransitioning
-   如何组合在一起完成功能

示例效果见demo点击后，弹出的绿色界面

### 步骤1：界面画出按钮，点击之后用 modal 显示 To2ViewController

````swift

    //模态视图切换效果
    @IBAction func Transitioning2(sender: AnyObject) {
        let toVC = To2ViewController()
        toVC.transitioningDelegate = self
        navigationController?.presentViewController(toVC, animated: true, completion: nil)
    }


````

### 步骤2：controller 实现 UIViewControllerTransitioningDelegate

demo中使用了extension的方式继承UIViewControllerTransitioningDelegate，好处是代码逻辑分离


````swift

//模态视图切换效果
extension ControllerTransitioningDemoViewController:UIViewControllerTransitioningDelegate{


    //返回Presented使用的UIViewControllerAnimatedTransitioning类
    func animationControllerForPresentedController(presented: UIViewController, presentingController presenting: UIViewController, sourceController source: UIViewController) -> UIViewControllerAnimatedTransitioning?{
        return PresentedAnimation()
    }

    //返回dismiss使用的UIViewControllerAnimatedTransitioning类
    func animationControllerForDismissedController(dismissed: UIViewController) -> UIViewControllerAnimatedTransitioning? {
        return DismissAnimation()
    }

}


###  步骤3: 实现一个过渡效果为自下而上弹出并有些晃动的UIViewControllerAnimatedTransitioning类

````



###

````swift


````



## controller present过渡效果


## UIViewControllerAnimatedTransitioning动画类的实现，完成点击后圆形区域放大过渡的动画效果


## 自定义手势过渡UIViewController及动画效果


## controller过渡和UIViewController的生命周期发生顺序

````swift


````

````swift


````

## demo
---
[本文的demo下载](https://github.com/coolnameismy/demo/AnimationAndEffects)

本文的代码对于的文件夹/ControllerTransitioning
-
-
-
-
-

如果大家支持，请在github上follow我，star我的项目

## 文章引用和参考
[iOS7中的ViewController切换](http://onevcat.com/2013/10/vc-transition-in-ios7/)
[实现通过圆圈放大缩小的转场动画](http://www.kittenyang.com/pingtransition/)